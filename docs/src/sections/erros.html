<section>
  <h2>üõ°Ô∏è Tratamento de Erros</h2>

  <h3>Estrutura do Erro</h3>
  <p>
    Quando uma requisi√ß√£o falha, o Ease-Fetch lan√ßa um objeto
    <code>ApiError</code> com informa√ß√µes estruturadas:
  </p>

  <div class="card">
    <pre><code>interface ApiError {
  message: string;  // Descri√ß√£o do erro (ex: "Not Found")
  status?: number;  // C√≥digo HTTP (ex: 404, 500)
  data?: unknown;   // Corpo da resposta do servidor (se dispon√≠vel)
}</code></pre>
  </div>

  <h3>Capturando Erros</h3>
  <p>
    Use blocos <code>try/catch</code> para capturar e tratar erros de forma
    elegante:
  </p>

  <div class="api-item">
    <h4>Tratamento B√°sico</h4>
    <pre><code>try {
  const user = await api.get('/users/999');
  console.log(user);
} catch (error) {
  console.error('Erro na requisi√ß√£o:', error.message);
  // Erro na requisi√ß√£o: Not Found
}</code></pre>
  </div>

  <div class="api-item">
    <h4>Verifica√ß√£o de Status HTTP</h4>
    <pre><code>try {
  const data = await api.post('/users', userData);
  showSuccessMessage('Usu√°rio criado!');
} catch (error) {
  if (error.status === 400) {
    showError('Dados inv√°lidos. Verifique os campos.');
  } else if (error.status === 401) {
    redirectToLogin();
  } else if (error.status === 409) {
    showError('Email j√° cadastrado.');
  } else if (error.status >= 500) {
    showError('Erro no servidor. Tente novamente mais tarde.');
  } else {
    showError('Erro desconhecido.');
  }
}</code></pre>
  </div>

  <div class="api-item">
    <h4>Acessando Detalhes do Erro</h4>
    <p>O servidor pode retornar informa√ß√µes adicionais no corpo da resposta:</p>
    <pre><code>try {
  await api.post('/users', { email: 'invalid' });
} catch (error) {
  console.log('Status:', error.status);        // 400
  console.log('Mensagem:', error.message);     // Bad Request
  console.log('Detalhes:', error.data);        
  // { field: 'email', error: 'Invalid email format' }
  
  // Exibir mensagem espec√≠fica do servidor
  if (error.data?.field) {
    showError(`${error.data.field}: ${error.data.error}`);
  }
}</code></pre>
  </div>

  <h3>Tratamento Global com Error Interceptors</h3>
  <p>
    Para evitar repeti√ß√£o de c√≥digo, use interceptors de erro para tratamento
    centralizado:
  </p>

  <div class="api-item">
    <pre><code>api.addResponseErrorInterceptor((error) => {
  // Logging autom√°tico
  console.error('API Error:', {
    status: error.status,
    message: error.message,
    data: error.data,
    timestamp: new Date().toISOString()
  });

  // Tratamento global de autentica√ß√£o
  if (error.status === 401) {
    localStorage.removeItem('token');
    window.location.href = '/login';
  }

  // Tratamento global de erros de servidor
  if (error.status >= 500) {
    showToast('Erro no servidor. Tente novamente em alguns instantes.', 'error');
  }

  // Re-lan√ßa o erro para tratamento local
  throw error;
});</code></pre>
  </div>

  <h3>Erros de Timeout</h3>
  <p>
    Quando uma requisi√ß√£o excede o tempo limite configurado, um erro de timeout
    √© lan√ßado:
  </p>

  <div class="api-item">
    <pre><code>try {
  const data = await api.get('/slow-endpoint', {
    timeoutMs: 5000 // 5 segundos
  });
} catch (error) {
  if (error.name === 'AbortError') {
    showError('A requisi√ß√£o demorou muito e foi cancelada.');
  }
}</code></pre>
  </div>

  <h3>C√≥digos HTTP Comuns</h3>
  <div class="api-list">
    <div class="api-item">
      <h4>2xx - Sucesso</h4>
      <ul>
        <li><code>200 OK</code> - Requisi√ß√£o bem-sucedida</li>
        <li><code>201 Created</code> - Recurso criado com sucesso</li>
        <li><code>204 No Content</code> - Sucesso sem corpo de resposta</li>
      </ul>
    </div>

    <div class="api-item">
      <h4>4xx - Erros do Cliente</h4>
      <ul>
        <li><code>400 Bad Request</code> - Dados inv√°lidos ou malformados</li>
        <li>
          <code>401 Unauthorized</code> - Autentica√ß√£o necess√°ria ou token
          inv√°lido
        </li>
        <li>
          <code>403 Forbidden</code> - Sem permiss√£o para acessar o recurso
        </li>
        <li><code>404 Not Found</code> - Recurso n√£o encontrado</li>
        <li><code>409 Conflict</code> - Conflito (ex: email duplicado)</li>
        <li><code>422 Unprocessable Entity</code> - Valida√ß√£o falhou</li>
        <li><code>429 Too Many Requests</code> - Rate limit excedido</li>
      </ul>
    </div>

    <div class="api-item">
      <h4>5xx - Erros do Servidor (Retry autom√°tico)</h4>
      <ul>
        <li>
          <code>500 Internal Server Error</code> - Erro gen√©rico no servidor
        </li>
        <li>
          <code>502 Bad Gateway</code> - Servidor intermedi√°rio com problema
        </li>
        <li>
          <code>503 Service Unavailable</code> - Servidor temporariamente
          indispon√≠vel
        </li>
        <li>
          <code>504 Gateway Timeout</code> - Servidor n√£o respondeu a tempo
        </li>
      </ul>
      <p>
        <strong>Nota:</strong> Para m√©todos GET, PUT e DELETE, o Ease-Fetch
        tenta automaticamente at√© 3 vezes antes de lan√ßar o erro.
      </p>
    </div>
  </div>

  <h3>Boas Pr√°ticas</h3>
  <ul>
    <li>‚úÖ Sempre use try/catch em requisi√ß√µes ass√≠ncronas</li>
    <li>‚úÖ Forne√ßa feedback visual ao usu√°rio em caso de erro</li>
    <li>‚úÖ Use error interceptors para logging e tratamento global</li>
    <li>‚úÖ Trate erros 401 redirecionando para login</li>
    <li>‚úÖ Mostre mensagens espec√≠ficas baseadas no c√≥digo de status</li>
    <li>‚úÖ Use error.data para exibir mensagens detalhadas do servidor</li>
    <li>‚ùå N√£o silencie erros sem feedback ao usu√°rio</li>
    <li>
      ‚ùå N√£o confie apenas em tratamento global - combine com local quando
      necess√°rio
    </li>
  </ul>
</section>
